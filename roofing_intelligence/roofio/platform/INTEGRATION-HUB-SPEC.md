# ROOFIO Integration Hub
## The "Trojan Horse" Super-Plugin Strategy

**Version:** 1.0
**Date:** December 2025
**Philosophy:** "We play nice with your current tools."

---

## THE CORE INSIGHT

> "People don't like change."

**The Wrong Approach:** "Throw away your current system and use ours."
**The Right Approach:** "Keep your current messy systemâ€”we just fix the one part you hate."

ROOFIO is NOT a replacement platform. It's a **Super-Plugin** that cleans up their existing mess.

---

## THE "LAND AND EXPAND" PSYCHOLOGY

### Phase 1: LAND (Single Pain Point)

A contractor discovers ROOFIO because they need ONE thing:

| Pain Point | What They Buy | The Hook |
|------------|---------------|----------|
| Weather delay disputes | Weather Truth Agent | "Never lose another weather claim" |
| OSHA crackdowns | JHA Gatekeeper | "Prove safety compliance instantly" |
| Insurance claims | Photo Chain of Custody | "GPS-stamped, hash-verified photos" |
| Silica regulations | Silica Tracker | "OSHA compliance documentation" |
| Scattered files | Magic Folder Sync | "Your photos, organized automatically" |

**Critical:** It works immediately because it connects to what they already use.

### Phase 2: EXPAND (Natural Discovery)

As they use that one feature, they discover more:
- "Oh, this syncs to my Dropbox? Nice."
- "Wait, it can also track my materials?"
- "My QuickBooks already has these job codes?"
- "The AI flagged a safety issue in my photo?"

**The platform grows WITH themâ€”not against them.**

### Marketing Language

âŒ DON'T SAY: "Integration" / "Platform Migration" / "Replace your tools"
âœ… DO SAY: "We play nice with your current tools"

- "Keep your Dropbox."
- "Keep your QuickBooks."
- "We just connect the field to the office so you don't have to chase paperwork."

---

## THE FOUR KILLER INTEGRATIONS

These are the "Trojan Horses" that get ROOFIO into every contractor's workflow.

---

### ğŸ—‚ï¸ 1. THE "MAGIC FOLDER" (Dropbox / Google Drive / OneDrive)

**The Problem:** Contractors have files scattered everywhere. They hate uploading things manually.

**The ROOFIO Solution:** Automatic folder structure + one-way sync.

#### How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MAGIC FOLDER SYNC                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  USER ACTION:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Foreman takes photo in Digital Foreman app             â”‚    â”‚
â”‚  â”‚  ğŸ“¸ â†’ [CAPTURE] â†’ GPS tagged, timestamped               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  ROOFIO AUTO-MAGIC:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Photo uploaded to THEIR existing cloud storage:        â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“ Dropbox/                                             â”‚    â”‚
â”‚  â”‚  â””â”€â”€ ğŸ“ Projects/                                        â”‚    â”‚
â”‚  â”‚      â””â”€â”€ ğŸ“ 2025/                                        â”‚    â”‚
â”‚  â”‚          â””â”€â”€ ğŸ“ UMass-Waterproofing/                     â”‚    â”‚
â”‚  â”‚              â””â”€â”€ ğŸ“ Photos/                              â”‚    â”‚
â”‚  â”‚                  â””â”€â”€ ğŸ“ Daily-Logs/                      â”‚    â”‚
â”‚  â”‚                      â””â”€â”€ ğŸ“¸ 2025-12-07_1423_roof-deck.jpgâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  PSYCHOLOGICAL BENEFIT:                                          â”‚
â”‚  Owner feels SAFE because they "own" their data on THEIR drive â”‚
â”‚  But they USE your app because it ORGANIZES it for them         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Folder Structure Auto-Created

When user connects ROOFIO to their cloud storage, we create:

```
ğŸ“ {Company}/Projects/{Year}/{Job-Number}/
â”œâ”€â”€ ğŸ“ Photos/
â”‚   â”œâ”€â”€ ğŸ“ Daily-Logs/
â”‚   â”œâ”€â”€ ğŸ“ Safety/
â”‚   â”œâ”€â”€ ğŸ“ Progress/
â”‚   â””â”€â”€ ğŸ“ Issues/
â”œâ”€â”€ ğŸ“ Documents/
â”‚   â”œâ”€â”€ ğŸ“ Submittals/
â”‚   â”œâ”€â”€ ğŸ“ RFIs/
â”‚   â”œâ”€â”€ ğŸ“ Change-Orders/
â”‚   â””â”€â”€ ğŸ“ Contracts/
â”œâ”€â”€ ğŸ“ Reports/
â”‚   â”œâ”€â”€ ğŸ“ Daily-Logs/
â”‚   â”œâ”€â”€ ğŸ“ Weather/
â”‚   â””â”€â”€ ğŸ“ Safety-JHAs/
â””â”€â”€ ğŸ“ Correspondence/
    â””â”€â”€ ğŸ“ Emails/
```

#### Technical Implementation

```typescript
// services/integrations/magic-folder.ts

interface MagicFolderConfig {
  provider: 'dropbox' | 'google_drive' | 'onedrive' | 'box';
  rootPath: string;
  projectId: string;
  syncRules: SyncRule[];
}

interface SyncRule {
  roofioPath: string;      // e.g., "/photos/daily"
  cloudPath: string;       // e.g., "/Photos/Daily-Logs"
  direction: 'push' | 'pull' | 'bidirectional';
  fileTypes: string[];     // e.g., ["jpg", "png", "pdf"]
  preserveMetadata: boolean;
}

// Event-driven sync
class MagicFolderService {

  async onPhotoUploaded(event: PhotoUploadedEvent) {
    const config = await this.getUserConfig(event.userId);

    if (!config.syncEnabled) return;

    // Build cloud path
    const cloudPath = this.buildPath(config, {
      year: event.timestamp.getFullYear(),
      jobNumber: event.project.jobNumber,
      category: this.categorizePhoto(event.photo),
      filename: this.buildFilename(event)
    });

    // Queue for async upload (never block the app)
    await this.syncQueue.add('upload', {
      provider: config.provider,
      localFile: event.photo.path,
      remotePath: cloudPath,
      metadata: {
        gps: event.photo.gps,
        timestamp: event.timestamp,
        capturedBy: event.userId,
        hash: event.photo.sha256
      }
    });
  }

  buildFilename(event: PhotoUploadedEvent): string {
    // 2025-12-07_1423_roof-deck_johndoe.jpg
    const date = format(event.timestamp, 'yyyy-MM-dd');
    const time = format(event.timestamp, 'HHmm');
    const desc = slugify(event.photo.description || 'photo');
    const user = event.user.lastName.toLowerCase();
    return `${date}_${time}_${desc}_${user}.jpg`;
  }
}
```

#### Supported Providers

| Provider | API | Auth | Real-time Sync |
|----------|-----|------|----------------|
| Dropbox | Dropbox API v2 | OAuth 2.0 | Webhooks âœ“ |
| Google Drive | Drive API v3 | OAuth 2.0 | Push Notifications âœ“ |
| OneDrive | Microsoft Graph | OAuth 2.0 | Webhooks âœ“ |
| Box | Box Platform | OAuth 2.0 | Webhooks âœ“ |
| SharePoint | Microsoft Graph | OAuth 2.0 | Webhooks âœ“ |

---

### ğŸ“§ 2. THE EMAIL "SIDECAR" (Outlook / Gmail Plugin)

**The Problem:** 80% of construction management happens in messy email threads. Important approvals get lost.

**The ROOFIO Solution:** A browser extension / Outlook Add-in with one magic button.

#### How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMAIL SIDECAR                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  OUTLOOK / GMAIL                                         â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚
â”‚  â”‚  From: john@acmeroofing.com                              â”‚    â”‚
â”‚  â”‚  Subject: RE: UMass Change Order #7 - APPROVED           â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  "Yes, approved. Go ahead with the additional           â”‚    â”‚
â”‚  â”‚   flashing at $4,200. See attached signed CO."          â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚   ğŸ“ CO-007-signed.pdf                                   â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ”µ ROOFIO  â”‚ [Save to Job â–¼]        â”‚  â† MAGIC BUTTONâ”‚    â”‚
â”‚  â”‚  â”‚             â”‚ UMass Waterproofing    â”‚                â”‚    â”‚
â”‚  â”‚  â”‚             â”‚ â””â”€â”€ Change Orders      â”‚                â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  AI EXTRACTION:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ Detected: Change Order Approval                       â”‚    â”‚
â”‚  â”‚  â€¢ Amount: $4,200                                        â”‚    â”‚
â”‚  â”‚  â€¢ Approved by: John Smith                               â”‚    â”‚
â”‚  â”‚  â€¢ Attachment: CO-007-signed.pdf                         â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  â†’ Filed to: UMass Waterproofing > Approvals > CO-007   â”‚    â”‚
â”‚  â”‚  â†’ Linked to: Change Event #7 in Project Manager        â”‚    â”‚
â”‚  â”‚  â†’ Status updated: APPROVED                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### AI Email Intelligence

```typescript
// services/integrations/email-sidecar.ts

interface EmailAnalysis {
  documentType: 'approval' | 'rfi' | 'submittal' | 'change_order' |
                'meeting_notes' | 'general';
  extractedData: {
    amounts?: number[];
    dates?: Date[];
    approver?: string;
    status?: 'approved' | 'rejected' | 'pending';
    references?: string[];  // "CO-007", "RFI-23", etc.
  };
  suggestedProject: Project | null;
  suggestedFolder: string;
  confidence: number;
}

class EmailSidecarService {

  async analyzeEmail(email: Email): Promise<EmailAnalysis> {
    // Extract structured data using AI
    const analysis = await this.ai.analyze({
      subject: email.subject,
      body: email.body,
      attachments: email.attachments.map(a => a.filename),
      from: email.from,
      thread: email.threadHistory
    });

    // Match to existing project
    const project = await this.matchProject(email, analysis);

    return {
      documentType: analysis.type,
      extractedData: analysis.extracted,
      suggestedProject: project,
      suggestedFolder: this.suggestFolder(analysis.type),
      confidence: analysis.confidence
    };
  }

  async saveToProject(email: Email, projectId: string, folder: string) {
    // 1. Save email content as record
    const record = await this.createEmailRecord(email, projectId);

    // 2. Upload attachments to Magic Folder
    for (const attachment of email.attachments) {
      await this.magicFolder.upload(attachment, {
        project: projectId,
        folder: folder,
        source: 'email',
        emailId: record.id
      });
    }

    // 3. Update related records (if change order, RFI, etc.)
    if (record.extractedData.references) {
      await this.linkToExistingRecords(record);
    }

    // 4. Notify team if needed
    await this.notifyTeam(record);
  }
}
```

#### Browser Extension Manifest

```json
// chrome-extension/manifest.json
{
  "manifest_version": 3,
  "name": "ROOFIO Email Sidecar",
  "version": "1.0.0",
  "description": "Save construction emails to your ROOFIO projects",
  "permissions": ["activeTab", "storage"],
  "host_permissions": [
    "https://mail.google.com/*",
    "https://outlook.office.com/*",
    "https://outlook.live.com/*"
  ],
  "content_scripts": [
    {
      "matches": [
        "https://mail.google.com/*",
        "https://outlook.office.com/*"
      ],
      "js": ["content.js"],
      "css": ["sidecar.css"]
    }
  ],
  "action": {
    "default_popup": "popup.html",
    "default_icon": "icons/roofio-48.png"
  }
}
```

---

### ğŸ’° 3. THE "GET PAID FASTER" LINK (QuickBooks / Xero / Sage)

**The Problem:** Field crew does work, but the office doesn't bill until weeks later because paperwork is slow.

**The ROOFIO Solution:** Live "Percent Complete" sync â†’ Ready to Bill triggers.

#### How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                GET PAID FASTER FLOW                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  FIELD (Digital Foreman App):                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“‹ Phase: Roof Tear-Off                                 â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 85%                  â”‚    â”‚
â”‚  â”‚           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚    â”‚
â”‚  â”‚           [Slide to update]                              â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“¸ Progress photos attached: 4                          â”‚    â”‚
â”‚  â”‚  âœ… Daily log complete                                   â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  [Mark 100% Complete]                                    â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼ Foreman slides to 100%               â”‚
â”‚                                                                  â”‚
â”‚  ROOFIO TRIGGERS:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. Update project phase status                          â”‚    â”‚
â”‚  â”‚  2. Compile progress photos as documentation             â”‚    â”‚
â”‚  â”‚  3. Push to QuickBooks: "Ready to Bill" flag             â”‚    â”‚
â”‚  â”‚  4. Draft AIA G702/G703 pay app                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  OFFICE (QuickBooks):                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ”” READY TO BILL                                        â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  Job: UMass Waterproofing                                â”‚    â”‚
â”‚  â”‚  Phase: Roof Tear-Off                                    â”‚    â”‚
â”‚  â”‚  Amount: $45,000                                         â”‚    â”‚
â”‚  â”‚  Status: 100% Complete (field verified)                  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“ Documentation attached:                              â”‚    â”‚
â”‚  â”‚     â€¢ 4 progress photos (GPS verified)                   â”‚    â”‚
â”‚  â”‚     â€¢ Daily log excerpt                                  â”‚    â”‚
â”‚  â”‚     â€¢ Foreman signature                                  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  [Create Invoice] [View Details]                         â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  WHY THEY BUY IT: Improves cash flow IMMEDIATELY                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### QuickBooks Integration

```typescript
// services/integrations/quickbooks.ts

interface QuickBooksConfig {
  realmId: string;          // QB company ID
  accessToken: string;
  refreshToken: string;
  syncSettings: {
    pullJobCodes: boolean;
    pullCustomers: boolean;
    pullVendors: boolean;
    pushTimeEntries: boolean;
    pushExpenses: boolean;
    pushReadyToBill: boolean;
  };
}

class QuickBooksService {

  // PULL: Import job codes from QuickBooks (so users don't re-enter)
  async importJobCodes(config: QuickBooksConfig): Promise<JobCode[]> {
    const response = await this.qb.query(
      `SELECT * FROM Item WHERE Type = 'Service'`,
      config
    );

    return response.Items.map(item => ({
      externalId: item.Id,
      code: item.Name,
      description: item.Description,
      rate: item.UnitPrice,
      source: 'quickbooks'
    }));
  }

  // PUSH: Send "Ready to Bill" when phase completes
  async pushReadyToBill(phase: ProjectPhase, photos: Photo[]) {
    const project = await this.getProject(phase.projectId);
    const qbJob = await this.getLinkedQBJob(project);

    // Create a "bill later" invoice or sales receipt
    const invoice = {
      CustomerRef: { value: qbJob.customerId },
      Line: [{
        Amount: phase.contractAmount,
        Description: `${phase.name} - 100% Complete`,
        DetailType: 'SalesItemLineDetail',
        SalesItemLineDetail: {
          ItemRef: { value: phase.jobCodeId },
          Qty: 1,
          UnitPrice: phase.contractAmount
        }
      }],
      CustomField: [{
        Name: 'ROOFIO Phase ID',
        StringValue: phase.id
      }],
      PrivateNote: `Auto-generated by ROOFIO. Photos: ${photos.length}`,
      // Attach documentation
      Attachments: await this.createAttachments(photos)
    };

    // Create as draft (not sent)
    const result = await this.qb.createInvoice(invoice, { draft: true });

    // Notify office
    await this.notifications.send({
      type: 'ready_to_bill',
      project: project,
      phase: phase,
      invoice: result,
      recipients: project.officeContacts
    });
  }

  // PUSH: Daily time entries to payroll
  async syncTimeEntries(dailyLog: DailyLog) {
    for (const labor of dailyLog.laborEntries) {
      await this.qb.createTimeActivity({
        EmployeeRef: { value: labor.employee.qbId },
        ItemRef: { value: labor.jobCode.qbId },
        Hours: labor.hours,
        Description: `${dailyLog.project.name} - ${dailyLog.date}`,
        TxnDate: dailyLog.date
      });
    }
  }
}
```

#### Data Flow Summary

| Direction | From | To | Data |
|-----------|------|-----|------|
| PULL | QuickBooks | ROOFIO | Jobs, Customers, Vendors, Cost Codes |
| PUSH | ROOFIO | QuickBooks | Time Entries, Expenses, Ready-to-Bill Flags |
| PUSH | ROOFIO | QuickBooks | Progress photos as invoice attachments |

---

### ğŸ“· 4. THE "VISUAL PROOF" HOOK (CompanyCam / EagleView)

**The Problem:** Roofers already love CompanyCam. You can't fight themâ€”you must join them.

**The ROOFIO Solution:** Two-way sync + AI intelligence layer on top.

#### How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VISUAL PROOF AI LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  They prefer taking photos in CompanyCam? LET THEM.             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   COMPANYCAM     â”‚      â”‚     ROOFIO       â”‚                 â”‚
â”‚  â”‚   (Photo App)    â”‚ â”€â”€â”€â–º â”‚   (AI Brain)     â”‚                 â”‚
â”‚  â”‚                  â”‚      â”‚                  â”‚                 â”‚
â”‚  â”‚  ğŸ“¸ Dumb storage â”‚      â”‚  ğŸ§  Smart analysisâ”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                   â”‚                              â”‚
â”‚                                   â–¼                              â”‚
â”‚  AI ANALYSIS:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“¸ Photo uploaded from CompanyCam sync                  â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ¤– AI Detection:                                        â”‚    â”‚
â”‚  â”‚     âš ï¸ SAFETY ISSUE DETECTED                             â”‚    â”‚
â”‚  â”‚     "Worker on roof without fall protection visible"     â”‚    â”‚
â”‚  â”‚     Confidence: 87%                                      â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚     ğŸ“ PROGRESS TRACKING                                 â”‚    â”‚
â”‚  â”‚     "Membrane installation ~60% complete"                â”‚    â”‚
â”‚  â”‚     "3 rolls visible in staging area"                    â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚     ğŸ”§ MATERIAL VERIFICATION                             â”‚    â”‚
â”‚  â”‚     "Detected: Carlisle TPO (matches submittal)"         â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  VALUE ADD: You add INTELLIGENCE on top of their DUMB STORAGE   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CompanyCam Integration

```typescript
// services/integrations/companycam.ts

class CompanyCamService {

  // Webhook receiver: CompanyCam sends us new photos
  async onPhotoCreated(webhook: CompanyCamWebhook) {
    const photo = webhook.photo;

    // 1. Match to ROOFIO project
    const project = await this.matchProject(photo.project_name);

    // 2. Download photo
    const imageData = await this.downloadPhoto(photo.urls.original);

    // 3. Preserve their metadata + add ours
    const enrichedPhoto = {
      externalId: photo.id,
      source: 'companycam',
      originalUrl: photo.urls.original,
      capturedAt: photo.captured_at,
      capturedBy: photo.creator.name,
      gps: {
        lat: photo.lat,
        lng: photo.lng
      },
      // Add ROOFIO chain of custody
      importedAt: new Date(),
      sha256: await this.hashImage(imageData)
    };

    // 4. Run AI analysis
    const analysis = await this.aiService.analyzePhoto(imageData, {
      projectContext: project,
      lookFor: ['safety_issues', 'progress', 'materials', 'defects']
    });

    // 5. Create alerts if issues found
    if (analysis.safetyIssues.length > 0) {
      await this.createSafetyAlert(project, photo, analysis.safetyIssues);
    }

    // 6. Update progress tracking if detected
    if (analysis.progressEstimate) {
      await this.updatePhaseProgress(project, analysis.progressEstimate);
    }

    // 7. Save to ROOFIO + sync to Magic Folder
    await this.savePhoto(enrichedPhoto, analysis);
  }
}
```

#### EagleView Integration

```typescript
// services/integrations/eagleview.ts

class EagleViewService {

  // Pull measurement reports
  async importMeasurementReport(orderId: string, projectId: string) {
    const report = await this.eagleview.getReport(orderId);

    // Extract key measurements
    const measurements = {
      totalRoofArea: report.roof_total_area,
      pitches: report.pitches,
      facets: report.facets,
      ridges: report.ridge_length,
      valleys: report.valley_length,
      eaves: report.eave_length,
      rakes: report.rake_length,
      hips: report.hip_length,
      flashings: report.flashing_length,
      // Waste factor calculation
      complexity: report.complexity_rating,
      suggestedWaste: this.calculateWaste(report.complexity_rating)
    };

    // Link to project
    await this.projects.addMeasurements(projectId, measurements);

    // Generate material takeoff
    const takeoff = await this.generateTakeoff(measurements, projectId);

    return { measurements, takeoff };
  }
}
```

---

## TECHNICAL ARCHITECTURE

### The Integration Hub (Middleware)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ROOFIO INTEGRATION HUB                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 INTEGRATION MANAGER                      â”‚    â”‚
â”‚  â”‚                 (OAuth2 Orchestrator)                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚           â–¼               â–¼               â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  CONNECTOR  â”‚ â”‚  CONNECTOR  â”‚ â”‚  CONNECTOR  â”‚               â”‚
â”‚  â”‚   SERVICE   â”‚ â”‚   SERVICE   â”‚ â”‚   SERVICE   â”‚               â”‚
â”‚  â”‚  (Storage)  â”‚ â”‚   (Email)   â”‚ â”‚ (Financial) â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚               â”‚               â”‚                        â”‚
â”‚         â–¼               â–¼               â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    SYNC AGENT                            â”‚    â”‚
â”‚  â”‚              (Redis/BullMQ Job Queue)                    â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚   Event-Driven: Never blocks the app                     â”‚    â”‚
â”‚  â”‚   Retry Logic: Exponential backoff                       â”‚    â”‚
â”‚  â”‚   Offline Queue: Syncs when connected                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    DATA MAPPER                           â”‚    â”‚
â”‚  â”‚              (JSON Schema Translator)                    â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚   ROOFIO Object â†â†’ External Format                       â”‚    â”‚
â”‚  â”‚   Daily_Log (JSON) â†’ PDF â†’ Email Attachment              â”‚    â”‚
â”‚  â”‚   Photo (ROOFIO) â†’ EXIF preserved â†’ Cloud Storage        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Core Services

```typescript
// services/integrations/integration-manager.ts

interface IntegrationProvider {
  id: string;
  name: string;
  category: 'storage' | 'email' | 'financial' | 'photo' | 'pm';
  authType: 'oauth2' | 'api_key' | 'webhook';
  status: 'active' | 'coming_soon' | 'beta';
}

const SUPPORTED_PROVIDERS: IntegrationProvider[] = [
  // STORAGE
  { id: 'dropbox', name: 'Dropbox', category: 'storage', authType: 'oauth2', status: 'active' },
  { id: 'google_drive', name: 'Google Drive', category: 'storage', authType: 'oauth2', status: 'active' },
  { id: 'onedrive', name: 'OneDrive', category: 'storage', authType: 'oauth2', status: 'active' },
  { id: 'box', name: 'Box', category: 'storage', authType: 'oauth2', status: 'active' },
  { id: 'sharepoint', name: 'SharePoint', category: 'storage', authType: 'oauth2', status: 'active' },

  // EMAIL
  { id: 'gmail', name: 'Gmail', category: 'email', authType: 'oauth2', status: 'active' },
  { id: 'outlook', name: 'Outlook', category: 'email', authType: 'oauth2', status: 'active' },

  // FINANCIAL
  { id: 'quickbooks_online', name: 'QuickBooks Online', category: 'financial', authType: 'oauth2', status: 'active' },
  { id: 'quickbooks_desktop', name: 'QuickBooks Desktop', category: 'financial', authType: 'api_key', status: 'active' },
  { id: 'xero', name: 'Xero', category: 'financial', authType: 'oauth2', status: 'active' },
  { id: 'sage', name: 'Sage', category: 'financial', authType: 'oauth2', status: 'coming_soon' },

  // PHOTO APPS
  { id: 'companycam', name: 'CompanyCam', category: 'photo', authType: 'oauth2', status: 'active' },
  { id: 'eagleview', name: 'EagleView', category: 'photo', authType: 'api_key', status: 'active' },

  // PROJECT MANAGEMENT
  { id: 'procore', name: 'Procore', category: 'pm', authType: 'oauth2', status: 'coming_soon' },
  { id: 'buildertrend', name: 'Buildertrend', category: 'pm', authType: 'oauth2', status: 'coming_soon' },

  // COMMUNICATION
  { id: 'slack', name: 'Slack', category: 'communication', authType: 'oauth2', status: 'active' },
  { id: 'teams', name: 'Microsoft Teams', category: 'communication', authType: 'oauth2', status: 'active' },

  // SIGNATURES
  { id: 'docusign', name: 'DocuSign', category: 'signatures', authType: 'oauth2', status: 'active' },

  // AUTOMATION
  { id: 'zapier', name: 'Zapier', category: 'automation', authType: 'webhook', status: 'active' },
  { id: 'make', name: 'Make (Integromat)', category: 'automation', authType: 'webhook', status: 'active' }
];
```

### Sync Queue Architecture

```typescript
// services/integrations/sync-queue.ts

import { Queue, Worker } from 'bullmq';

// Job types
type SyncJobType =
  | 'upload_photo'
  | 'sync_email'
  | 'push_time_entry'
  | 'push_ready_to_bill'
  | 'import_job_codes'
  | 'webhook_delivery';

interface SyncJob {
  type: SyncJobType;
  provider: string;
  userId: string;
  projectId?: string;
  payload: any;
  priority: 'high' | 'normal' | 'low';
  retryCount: number;
}

// Queue configuration
const syncQueue = new Queue('integration-sync', {
  defaultJobOptions: {
    attempts: 5,
    backoff: {
      type: 'exponential',
      delay: 1000  // 1s, 2s, 4s, 8s, 16s
    },
    removeOnComplete: 100,
    removeOnFail: 1000
  }
});

// Worker processor
const worker = new Worker('integration-sync', async (job) => {
  const { type, provider, payload } = job.data;

  switch (type) {
    case 'upload_photo':
      return await storageService.uploadPhoto(provider, payload);
    case 'sync_email':
      return await emailService.saveEmail(provider, payload);
    case 'push_time_entry':
      return await financialService.pushTimeEntry(provider, payload);
    case 'push_ready_to_bill':
      return await financialService.pushReadyToBill(provider, payload);
    default:
      throw new Error(`Unknown job type: ${type}`);
  }
}, {
  concurrency: 10,
  limiter: {
    max: 100,
    duration: 60000  // 100 jobs per minute per provider
  }
});
```

### Database Schema (Integration Tables)

```sql
-- User integration connections
CREATE TABLE user_integrations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) NOT NULL,
  provider VARCHAR(50) NOT NULL,  -- 'dropbox', 'quickbooks', etc.
  status VARCHAR(20) DEFAULT 'active',

  -- OAuth tokens (encrypted)
  access_token_encrypted TEXT,
  refresh_token_encrypted TEXT,
  token_expires_at TIMESTAMPTZ,

  -- Provider-specific settings
  settings JSONB DEFAULT '{}',
  -- e.g., { "root_folder": "/Projects", "sync_photos": true }

  -- Sync state
  last_sync_at TIMESTAMPTZ,
  last_sync_status VARCHAR(20),
  sync_cursor TEXT,  -- For incremental sync

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(user_id, provider)
);

-- Project-level integration mappings
CREATE TABLE project_integrations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id UUID REFERENCES projects(id) NOT NULL,
  integration_id UUID REFERENCES user_integrations(id) NOT NULL,

  -- External IDs
  external_folder_id TEXT,    -- Cloud storage folder ID
  external_project_id TEXT,   -- QuickBooks job ID, Procore project ID
  external_customer_id TEXT,  -- QuickBooks customer ID

  -- Mapping configuration
  folder_mapping JSONB DEFAULT '{}',
  -- e.g., { "photos": "/Photos", "daily_logs": "/Reports/Daily" }

  sync_enabled BOOLEAN DEFAULT true,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Sync job history (for debugging)
CREATE TABLE integration_sync_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  integration_id UUID REFERENCES user_integrations(id),
  job_type VARCHAR(50),
  status VARCHAR(20),  -- 'pending', 'processing', 'completed', 'failed'

  payload JSONB,
  result JSONB,
  error_message TEXT,

  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Webhook subscriptions (for receiving data from providers)
CREATE TABLE webhook_subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  integration_id UUID REFERENCES user_integrations(id),
  provider VARCHAR(50),
  event_type VARCHAR(100),  -- 'photo.created', 'file.changed'

  webhook_url TEXT,
  webhook_secret TEXT,

  status VARCHAR(20) DEFAULT 'active',
  last_received_at TIMESTAMPTZ,

  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## UI: THE APP STORE EXPERIENCE

### Integration Settings Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ Settings > Integrations                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "We play nice with your current tools."                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ” Search integrations...                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“ FILE STORAGE                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ğŸ“¦      â”‚ â”‚ ğŸ“      â”‚ â”‚ â˜ï¸      â”‚ â”‚ ğŸ“¤      â”‚               â”‚
â”‚  â”‚ Dropbox â”‚ â”‚ Google  â”‚ â”‚ OneDriveâ”‚ â”‚ Box     â”‚               â”‚
â”‚  â”‚         â”‚ â”‚ Drive   â”‚ â”‚         â”‚ â”‚         â”‚               â”‚
â”‚  â”‚ âœ… ON   â”‚ â”‚ [Connect]â”‚ â”‚ [Connect]â”‚ â”‚ [Connect]â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“§ EMAIL                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ âœ‰ï¸      â”‚ â”‚ ğŸ“¬      â”‚                                        â”‚
â”‚  â”‚ Gmail   â”‚ â”‚ Outlook â”‚                                        â”‚
â”‚  â”‚         â”‚ â”‚         â”‚                                        â”‚
â”‚  â”‚ [Connect]â”‚ â”‚ âœ… ON   â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                  â”‚
â”‚  ğŸ’° ACCOUNTING                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ ğŸ“Š      â”‚ â”‚ ğŸ“ˆ      â”‚ â”‚ ğŸ§®      â”‚                            â”‚
â”‚  â”‚ Quick-  â”‚ â”‚ Xero    â”‚ â”‚ Sage    â”‚                            â”‚
â”‚  â”‚ Books   â”‚ â”‚         â”‚ â”‚         â”‚                            â”‚
â”‚  â”‚ âœ… ON   â”‚ â”‚ [Connect]â”‚ â”‚ Coming  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“· PHOTO APPS                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ ğŸ“¸      â”‚ â”‚ ğŸ›°ï¸      â”‚                                        â”‚
â”‚  â”‚ Company â”‚ â”‚ Eagle   â”‚                                        â”‚
â”‚  â”‚ Cam     â”‚ â”‚ View    â”‚                                        â”‚
â”‚  â”‚ [Connect]â”‚ â”‚ [Connect]â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”— AUTOMATION                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ âš¡      â”‚ â”‚ ğŸ”„      â”‚                                        â”‚
â”‚  â”‚ Zapier  â”‚ â”‚ Make    â”‚                                        â”‚
â”‚  â”‚         â”‚ â”‚         â”‚                                        â”‚
â”‚  â”‚ [Connect]â”‚ â”‚ [Connect]â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Connected Integration Detail View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back    ğŸ“¦ Dropbox                           [Disconnect]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  âœ… Connected as: john@lefebvredesign.com                       â”‚
â”‚  Last synced: 2 minutes ago                                      â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“ ROOT FOLDER                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /Lefebvre Design/Projects                              â”‚    â”‚
â”‚  â”‚  [Change Folder]                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ”„ SYNC SETTINGS                                                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“¸ Photos                               [âœ“] Auto-sync   â”‚    â”‚
â”‚  â”‚     Uploads field photos to /Photos/Daily-Logs          â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“„ Documents                            [âœ“] Auto-sync   â”‚    â”‚
â”‚  â”‚     Syncs submittals, RFIs, change orders               â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“‹ Reports                              [âœ“] Auto-sync   â”‚    â”‚
â”‚  â”‚     Daily logs saved as PDFs to /Reports                â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚  ğŸ“§ Emails                               [ ] Auto-sync   â”‚    â”‚
â”‚  â”‚     Saved correspondence (optional)                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“Š SYNC HISTORY                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  âœ“ 2 min ago   Photo uploaded (roof-deck-progress.jpg) â”‚    â”‚
â”‚  â”‚  âœ“ 15 min ago  Daily log PDF saved                      â”‚    â”‚
â”‚  â”‚  âœ“ 1 hr ago    4 photos synced                          â”‚    â”‚
â”‚  â”‚  âš ï¸ 2 hrs ago   Retry: connection timeout               â”‚    â”‚
â”‚  â”‚  âœ“ 3 hrs ago   Submittal document synced                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ZAPIER / MAKE INTEGRATION (NO-CODE AUTOMATION)

For contractors who want custom workflows without code:

### ROOFIO Zapier Triggers

| Trigger | Description |
|---------|-------------|
| New Photo Uploaded | When a photo is captured in Digital Foreman |
| Daily Log Completed | When a foreman submits their daily log |
| JHA Signed | When safety JHA is signed and verified |
| Phase Completed | When a project phase hits 100% |
| Weather Flag Triggered | When auto-weather detects delay conditions |
| Safety Issue Detected | When AI detects safety concern in photo |
| Material Scanned | When barcode/QR verified against submittal |

### ROOFIO Zapier Actions

| Action | Description |
|--------|-------------|
| Create Project | Set up new project with details |
| Add Photo to Project | Upload photo with metadata |
| Create Daily Log Entry | Add labor, equipment, notes |
| Update Phase Progress | Set percentage complete |
| Send Notification | Alert team members |
| Generate Report | Create PDF daily log or progress report |

### Example Zaps

1. **Photo â†’ Slack Alert**
   - Trigger: New Photo Uploaded (with safety issue)
   - Action: Send Slack message to #safety channel with photo

2. **Daily Log â†’ Google Sheets**
   - Trigger: Daily Log Completed
   - Action: Add row to project tracking spreadsheet

3. **Phase Complete â†’ QuickBooks Invoice**
   - Trigger: Phase Completed (100%)
   - Action: Create draft invoice in QuickBooks

4. **Weather Flag â†’ Email Alert**
   - Trigger: Weather Flag Triggered
   - Action: Email project manager and owner

---

## IMPLEMENTATION PRIORITY

### Phase 1: Foundation (Weeks 1-2)
1. Integration Manager service (OAuth2 flows)
2. Sync Queue (BullMQ + Redis)
3. Database schema for integrations
4. Settings UI (App Store style)

### Phase 2: Magic Folder (Weeks 3-4)
1. Dropbox connector
2. Google Drive connector
3. OneDrive connector
4. Auto-folder structure creation
5. Photo sync (ROOFIO â†’ Cloud)

### Phase 3: Get Paid Faster (Weeks 5-6)
1. QuickBooks Online connector
2. Job code import
3. Time entry push
4. Ready-to-Bill triggers

### Phase 4: Email Sidecar (Weeks 7-8)
1. Gmail browser extension
2. Outlook Add-in
3. AI email analysis
4. One-click save to project

### Phase 5: Visual Proof (Weeks 9-10)
1. CompanyCam webhook receiver
2. Photo import + AI analysis
3. EagleView measurement import
4. Safety issue detection

### Phase 6: Automation (Week 11-12)
1. Zapier integration
2. Make integration
3. Webhook delivery system
4. Custom workflow builder

---

## SUCCESS METRICS

### Adoption Metrics

| Metric | Target | Why It Matters |
|--------|--------|----------------|
| Integration Connection Rate | 70% connect â‰¥1 | Validates "Super-Plugin" positioning |
| Magic Folder Usage | 60% of photos synced | Core value prop working |
| Email Sidecar Installs | 40% of users | Email is where work happens |
| QuickBooks Connection | 50% of paying users | Billing acceleration = retention |

### Expansion Metrics

| Metric | Target | Why It Matters |
|--------|--------|----------------|
| Features Used (Start) | 1.2 avg | Land with single feature |
| Features Used (90 days) | 3.5 avg | Expand into platform |
| Cross-feature Discovery | 25% /month | Natural expansion working |
| Upgrade from Free | 35% in 60 days | Integration hook converts |

### Net Revenue Retention

| Metric | Target | Why It Matters |
|--------|--------|----------------|
| NDR | >120% | Expansion > Churn |
| Upsell Rate | 30% /year | Integration users buy more |
| Churn Rate | <5% /year | Integrations create stickiness |

---

## THE BOTTOM LINE

**Old Pitch:** "Replace everything with ROOFIO"
**Result:** ğŸ˜  "No thanks, I already have tools"

**New Pitch:** "Keep your Dropbox, your QuickBooks, your email. ROOFIO just fixes the one thing you hate."
**Result:** ğŸ¤” "Okay, I'll try the weather documentation..."
**30 days later:** ğŸ˜ "Wait, this also does safety tracking? And it syncs to my Drive?"

**That's the Trojan Horse.**

---

*"We play nice with your current tools."*
